<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>reshape-state - v1.4.1</title><meta name="description" content="Documentation for reshape-state"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">reshape-state - v1.4.1</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h2>reshape-state - v1.4.1</h2></div><div class="tsd-panel tsd-typography"><a id="md:reshape-state" class="tsd-anchor"></a><h1><a href="#md:reshape-state">reshape-state</a></h1><p>A <a href="https://github.com/rlmcneary2/reshape-state">small state management library</a>.
Use a reshaper to manage acquiring data for a state object from multiple
asynchronous sources.</p>
<p>An <a href="https://codesandbox.io/s/reshape-state-0617h?file=/src/swapi/character-reshaper.ts">example
application</a>
that uses reshape-state is available at
<a href="https://codesandbox.io/s/reshape-state-0617h?file=/src/swapi/character-reshaper.ts">codesandbox.io</a>.</p>
<ul>
<li><a href="#md:install">Install</a></li>
<li><a href="#md:usage">Usage</a><ul>
<li><a href="https://rlmcneary2.github.io/reshape-state">Detailed code documentation</a></li>
<li><a href="#md:create">Create a reshaper</a></li>
<li><a href="#md:provide-the-current-state">Provide the current state</a></li>
<li><a href="#md:listen-for-state-changes">Listen for state changes</a></li>
<li><a href="#md:dispatch-actions-to-handlers">Dispatch actions to handlers</a></li>
<li><a href="#md:update-state-with-handler-functions">Update state with handler functions</a></li>
<li><a href="#md:dispatch-inline-handlers">Dispatch inline handlers</a></li>
<li><a href="#md:changing-state-without-an-action">Changing state without an action</a></li>
<li><a href="#md:remove-listeners-and-handlers">Remove listeners and handlers</a></li>
</ul>
</li>
<li><a href="#md:tips-and-tricks">Tips &amp; Tricks</a><ul>
<li><a href="#md:create-handler-functions-using-a-factory-function">Create handler functions using a factory function</a></li>
<li><a href="#md:react-integration">React integration</a></li>
</ul>
</li>
</ul>
<a id="md:install" class="tsd-anchor"></a><h2><a href="#md:install">Install</a></h2><pre><code class="language-bash"><span class="hl-0">yarn</span><span class="hl-1"> </span><span class="hl-2">add</span><span class="hl-1"> </span><span class="hl-2">reshape-state</span>
</code><button>Copy</button></pre>
<a id="md:usage" class="tsd-anchor"></a><h2><a href="#md:usage">Usage</a></h2><a id="md:create" class="tsd-anchor"></a><h3><a href="#md:create">Create</a></h3><p>Create a reshaper that will manage state change actions, manipulating state, and
notifying subscribers when it changes.</p>
<pre><code class="language-ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">create</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;reshape-state&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">reshaper</span><span class="hl-1"> = </span><span class="hl-0">create</span><span class="hl-1">&lt;</span><span class="hl-7">State</span><span class="hl-1">&gt;();</span>
</code><button>Copy</button></pre>
<a id="md:provide-the-current-state" class="tsd-anchor"></a><h3><a href="#md:provide-the-current-state">Provide the current state</a></h3><p>The reshaper does not maintain state, it updates state. The reshaper also is
agnostic about the type of state, it could be an object, string, number, etc. To
provide the current state to the reshaper - which it will pass to the handler
functions - provide a function to the reshaper which when invoked returns the
current state.</p>
<pre><code class="language-ts"><span class="hl-5">let</span><span class="hl-1"> </span><span class="hl-4">currentState</span><span class="hl-1">: </span><span class="hl-7">unknown</span><span class="hl-1">;</span><br/><span class="hl-4">reshaper</span><span class="hl-1">.</span><span class="hl-0">setGetState</span><span class="hl-1">(() </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-4">currentState</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<a id="md:listen-for-state-changes" class="tsd-anchor"></a><h3><a href="#md:listen-for-state-changes">Listen for state changes</a></h3><p>Add an OnChange callback to be notified when state changes.</p>
<pre><code class="language-ts"><span class="hl-5">let</span><span class="hl-1"> </span><span class="hl-4">currentState</span><span class="hl-1">: </span><span class="hl-7">unknown</span><span class="hl-1">;</span><br/><span class="hl-4">reshaper</span><span class="hl-1">.</span><span class="hl-0">addOnChange</span><span class="hl-1">(</span><span class="hl-4">state</span><span class="hl-1"> </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-4">currentState</span><span class="hl-1"> = </span><span class="hl-4">state</span><span class="hl-1">));</span>
</code><button>Copy</button></pre>
<a id="md:dispatch-actions-to-handlers" class="tsd-anchor"></a><h3><a href="#md:dispatch-actions-to-handlers">Dispatch actions to handlers</a></h3><p>When state needs to be changed use <code>dispatch</code> with one or more tasks as
parameters. Any Action tasks have one required property <code>id</code> which can be a
string or number; the optional <code>payload</code> contains information used to update
state. <a href="#md:dispatch-inline-handlers">Inline handlers can also be dispatched</a>.</p>
<pre><code class="language-ts"><span class="hl-4">reshaper</span><span class="hl-1">.</span><span class="hl-0">dispatch</span><span class="hl-1">({ </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;name&quot;</span><span class="hl-1">, </span><span class="hl-4">payload:</span><span class="hl-1"> </span><span class="hl-2">&quot;Alice&quot;</span><span class="hl-1"> }, { </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;age&quot;</span><span class="hl-1">, </span><span class="hl-4">payload:</span><span class="hl-1"> </span><span class="hl-8">30</span><span class="hl-1"> });</span>
</code><button>Copy</button></pre>
<a id="md:update-state-with-handler-functions" class="tsd-anchor"></a><h3><a href="#md:update-state-with-handler-functions">Update state with handler functions</a></h3><p>Add handler functions to change state.</p>
<pre><code class="language-ts"><span class="hl-4">reshaper</span><span class="hl-1">.</span><span class="hl-0">addHandlers</span><span class="hl-1">([</span><br/><span class="hl-1">  (</span><span class="hl-4">state</span><span class="hl-1">, </span><span class="hl-4">action</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">action</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1"> === </span><span class="hl-2">&quot;name&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">state</span><span class="hl-1">.</span><span class="hl-4">name</span><span class="hl-1"> = </span><span class="hl-4">action</span><span class="hl-1">.</span><span class="hl-4">payload</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-3">return</span><span class="hl-1"> [</span><span class="hl-4">state</span><span class="hl-1">, </span><span class="hl-5">true</span><span class="hl-1">];</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> [</span><span class="hl-4">state</span><span class="hl-1">];</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  (</span><span class="hl-4">state</span><span class="hl-1">, </span><span class="hl-4">action</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">action</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1"> === </span><span class="hl-2">&quot;family-name&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">state</span><span class="hl-1">.</span><span class="hl-4">familyName</span><span class="hl-1"> = </span><span class="hl-4">action</span><span class="hl-1">.</span><span class="hl-4">payload</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-3">return</span><span class="hl-1"> [</span><span class="hl-4">state</span><span class="hl-1">, </span><span class="hl-5">true</span><span class="hl-1">];</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> [</span><span class="hl-4">state</span><span class="hl-1">];</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">]);</span>
</code><button>Copy</button></pre>
<p>The handler functions must be synchronous and return at least a state object but
they can start asynchronous code and dispatch a task when they finish (i.e they
can have &quot;side-effects&quot;). In fact handlers don&#39;t have to react to an action,
they can do something based on the current shape of the state. In the example
below once state contains a <code>name</code> the address associated with that name will be
fetched. The idea is that changing one piece of state can cause another one to
be updated without requiring an intermediate action.</p>
<pre><code class="language-ts"><span class="hl-4">reshaper</span><span class="hl-1">.</span><span class="hl-0">addHandlers</span><span class="hl-1">([</span><br/><span class="hl-1">  (</span><span class="hl-4">state</span><span class="hl-1">, </span><span class="hl-4">_</span><span class="hl-1">, </span><span class="hl-4">dispatch</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">state</span><span class="hl-1">.</span><span class="hl-4">name</span><span class="hl-1"> &amp;&amp; !</span><span class="hl-4">state</span><span class="hl-1">.</span><span class="hl-4">address</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">fetch</span><span class="hl-1">(</span><span class="hl-2">`</span><span class="hl-5">${</span><span class="hl-4">address_url</span><span class="hl-5">}</span><span class="hl-2">?name=</span><span class="hl-5">${</span><span class="hl-4">state</span><span class="hl-9">.</span><span class="hl-4">name</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">).</span><span class="hl-0">then</span><span class="hl-1">(</span><span class="hl-4">response</span><span class="hl-1"> </span><span class="hl-5">=&gt;</span><br/><span class="hl-1">        </span><span class="hl-0">dispatch</span><span class="hl-1">({ </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;address&quot;</span><span class="hl-1">, </span><span class="hl-4">payload:</span><span class="hl-1"> </span><span class="hl-4">response</span><span class="hl-1"> })</span><br/><span class="hl-1">      );</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> [</span><span class="hl-4">state</span><span class="hl-1">];</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  (</span><span class="hl-4">state</span><span class="hl-1">, </span><span class="hl-4">action</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">action</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1"> === </span><span class="hl-2">&quot;address&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">state</span><span class="hl-1">.</span><span class="hl-4">address</span><span class="hl-1"> = </span><span class="hl-4">action</span><span class="hl-1">.</span><span class="hl-4">payload</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-3">return</span><span class="hl-1"> [</span><span class="hl-4">state</span><span class="hl-1">, </span><span class="hl-5">true</span><span class="hl-1">];</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> [</span><span class="hl-4">state</span><span class="hl-1">];</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">]);</span>
</code><button>Copy</button></pre>
<p>You may have noticed state can be mutated - or not - it&#39;s up to you. State
change is indicated by the optional second element in the return array not by
object equality. If the second element is not provided the default is that state
has not changed.</p>
<a id="md:dispatch-inline-handlers" class="tsd-anchor"></a><h3><a href="#md:dispatch-inline-handlers">Dispatch inline handlers</a></h3><p>Typically after starting asynchronous code in a handler the convention is to
dispatch another Action which will inform all handlers of the asynchronous
code&#39;s completion and one or more of the handlers will use the action to update
state. Sometimes there is no no need to inform all the handlers about the
asynchronous result but simply to update state with the result. In this case an
<code>InlineHandler</code> can be dispatched which will be invoked with the current state.
Like other handler functions it must synchronously return a state object and an
indication if the state has changed.</p>
<pre><code class="language-ts"><span class="hl-4">reshaper</span><span class="hl-1">.</span><span class="hl-0">addHandlers</span><span class="hl-1">([</span><br/><span class="hl-1">  (</span><span class="hl-4">state</span><span class="hl-1">, </span><span class="hl-4">action</span><span class="hl-1">, </span><span class="hl-4">dispatch</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">action</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1"> === </span><span class="hl-2">&quot;address&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">fetch</span><span class="hl-1">(</span><span class="hl-2">`</span><span class="hl-5">${</span><span class="hl-4">address_url</span><span class="hl-5">}</span><span class="hl-2">?name=</span><span class="hl-5">${</span><span class="hl-4">state</span><span class="hl-9">.</span><span class="hl-4">name</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">).</span><span class="hl-0">then</span><span class="hl-1">(</span><span class="hl-4">response</span><span class="hl-1"> </span><span class="hl-5">=&gt;</span><br/><span class="hl-1">        </span><span class="hl-10">// Dispatch an InlineHandler that will update state with the</span><br/><span class="hl-1">        </span><span class="hl-10">// asynchronous result when it is invoked.</span><br/><span class="hl-1">        </span><span class="hl-0">dispatch</span><span class="hl-1">(</span><span class="hl-4">currentState</span><span class="hl-1"> </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-4">currentState</span><span class="hl-1">.</span><span class="hl-4">address</span><span class="hl-1"> = </span><span class="hl-4">response</span><span class="hl-1">;</span><br/><span class="hl-1">          </span><span class="hl-3">return</span><span class="hl-1"> [</span><span class="hl-4">currentState</span><span class="hl-1">, </span><span class="hl-5">true</span><span class="hl-1">];</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">      );</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> [</span><span class="hl-4">state</span><span class="hl-1">];</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">]);</span>
</code><button>Copy</button></pre>
<a id="md:changing-state-without-an-action" class="tsd-anchor"></a><h3><a href="#md:changing-state-without-an-action">Changing state without an action</a></h3><p>There may be situations where you&#39;d like a change to state to trigger further
changes to state in a different handler. This could be accomplished using a
&quot;chain&quot; of dispatched actions however if it&#39;s possible to determine what updates
to state are needed based on the current state you can configure the reshaper to
iterate over all the handlers you provide until state does not change.</p>
<p>To enable this mode pass the <code>loopUntilSettled</code> property as an option to the
<code>create</code> function.</p>
<pre><code class="language-ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">create</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;reshape-state&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">reshaper</span><span class="hl-1"> = </span><span class="hl-0">create</span><span class="hl-1">&lt;</span><span class="hl-7">State</span><span class="hl-1">&gt;({ </span><span class="hl-4">loopUntilSettled:</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1"> });</span>
</code><button>Copy</button></pre>
<p>Now when an action is dispatched - or an inline handler is invoked - that
results in a change to state every handler will be called again with a special
action. This action will have its <code>id</code> set to null and will not include a
payload.</p>
<p>For example this would be useful if you knew that after fetching data from a
remote service and updating state that subsequent requests to another service
must be made for more information.</p>
<a id="md:remove-listeners-and-handlers" class="tsd-anchor"></a><h3><a href="#md:remove-listeners-and-handlers">Remove listeners and handlers</a></h3><p>If the reshaper is no longer needed the OnChange callback and handlers should be
removed.</p>
<pre><code class="language-ts"><span class="hl-4">reshaper</span><span class="hl-1">.</span><span class="hl-0">removeHandlers</span><span class="hl-1">(</span><span class="hl-4">handlers</span><span class="hl-1">);</span><br/><span class="hl-4">reshaper</span><span class="hl-1">.</span><span class="hl-0">removeOnChange</span><span class="hl-1">(</span><span class="hl-4">handleChange</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<a id="md:tips" class="tsd-anchor"></a><h2><a href="#md:tips">Tips</a></h2><a id="md:create-handler-functions-using-a-factory-function" class="tsd-anchor"></a><h3><a href="#md:create-handler-functions-using-a-factory-function">Create handler functions using a factory function</a></h3><p>There are several reasons for using a factory function:</p>
<ul>
<li>Move handlers into separate, domain specific module files.</li>
<li>Create a scope for data that is only needed by, and private to, the handler functions.</li>
</ul>
<p>The reshaper&#39;s <code>addHandlers</code> function accepts an array of handlers so your factory function must return an array. Eventually you will probably want to pass data to your handlers that they need while they are processing state, or you may need to define variables for the handlers that are only needed by the handlers. During development there may be a variety of variables that change based on the environment your code is deployed to, like &quot;dev,&quot; &quot;staging,&quot; or &quot;production&quot; so a fairly common pattern I use looks like the following example:</p>
<pre><code class="language-ts"><span class="hl-10">/**</span><br/><span class="hl-10"> * auth-handlers.ts</span><br/><span class="hl-10"> */</span><br/><br/><span class="hl-10">// This exported function can be called to generate an array of handler</span><br/><span class="hl-10">// functions to pass to the reshaper.</span><br/><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-5">function</span><span class="hl-1"> </span><span class="hl-0">createAuthHandlers</span><span class="hl-1">(</span><span class="hl-4">protocol</span><span class="hl-1">: </span><span class="hl-2">&quot;http&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;https&quot;</span><span class="hl-1">, </span><span class="hl-4">domain</span><span class="hl-1">: </span><span class="hl-7">string</span><span class="hl-1">, </span><span class="hl-4">port</span><span class="hl-1">?: </span><span class="hl-7">number</span><span class="hl-1">){</span><br/><span class="hl-1">  </span><span class="hl-10">// Parts of the service URL that the application needs to talk to may change,</span><br/><span class="hl-1">  </span><span class="hl-10">// so they are passed to the handlers as arguments to the factory function.</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">serviceUrl</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">URL</span><span class="hl-1">(</span><span class="hl-2">`</span><span class="hl-5">${</span><span class="hl-4">protocol</span><span class="hl-5">}</span><span class="hl-2">://</span><span class="hl-5">${</span><span class="hl-4">domain</span><span class="hl-5">}${</span><span class="hl-4">port</span><span class="hl-9"> </span><span class="hl-1">?</span><span class="hl-9"> </span><span class="hl-2">`:</span><span class="hl-5">${</span><span class="hl-4">port</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-9"> </span><span class="hl-1">:</span><span class="hl-9"> </span><span class="hl-2">&quot;&quot;</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  </span><span class="hl-10">// We&#39;ll use this flag to prevent multiple asynchronous requests to read the</span><br/><span class="hl-1">  </span><span class="hl-10">// user from being started. Since this variable is only needed by the</span><br/><span class="hl-1">  </span><span class="hl-10">// `readUser` function we create it inside the factory function.</span><br/><span class="hl-1">  </span><span class="hl-5">let</span><span class="hl-1"> </span><span class="hl-4">readUserStatus</span><span class="hl-1">: </span><span class="hl-2">&quot;active&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;inactive&quot;</span><span class="hl-1"> = </span><span class="hl-2">&quot;inactive&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-0">readUser</span><span class="hl-1">: </span><span class="hl-7">ActionHandler</span><span class="hl-1">&lt;</span><span class="hl-7">State</span><span class="hl-1">, </span><span class="hl-7">User</span><span class="hl-1">&gt; = (</span><span class="hl-4">state</span><span class="hl-1">, </span><span class="hl-4">action</span><span class="hl-1">, </span><span class="hl-4">dispatch</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">action</span><span class="hl-1">.</span><span class="hl-4">type</span><span class="hl-1"> !== </span><span class="hl-2">&quot;read-user&quot;</span><span class="hl-1">){</span><br/><span class="hl-1">      </span><span class="hl-3">return</span><span class="hl-1"> [</span><span class="hl-4">state</span><span class="hl-1">];</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-10">// If we&#39;re already in a read operation the do not start another one.</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">readUserState</span><span class="hl-1"> === </span><span class="hl-2">&quot;active&quot;</span><span class="hl-1">){</span><br/><span class="hl-1">      </span><span class="hl-3">return</span><span class="hl-1"> [</span><span class="hl-4">state</span><span class="hl-1">];</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-10">// Not currently reading the user, set the flag so we know not to start</span><br/><span class="hl-1">    </span><span class="hl-10">// another user read.</span><br/><span class="hl-1">    </span><span class="hl-4">readUserStatus</span><span class="hl-1"> = </span><span class="hl-2">&quot;active&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-1">    </span><span class="hl-0">fetch</span><span class="hl-1">(</span><span class="hl-4">serviceUrl</span><span class="hl-1">)</span><br/><span class="hl-1">      .</span><span class="hl-0">then</span><span class="hl-1">(</span><span class="hl-4">response</span><span class="hl-1"> </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-10">// If none of our other handlers need to know that the read is complete</span><br/><span class="hl-1">        </span><span class="hl-10">// then an inline handler can be used to simplify updating state.</span><br/><span class="hl-1">        </span><span class="hl-0">dispatch</span><span class="hl-1">(</span><span class="hl-4">inlineState</span><span class="hl-1"> </span><span class="hl-5">=&gt;</span><span class="hl-1"> [{...</span><span class="hl-4">inlineState</span><span class="hl-1">, </span><span class="hl-4">userResponse:</span><span class="hl-1"> </span><span class="hl-4">response</span><span class="hl-1">}, </span><span class="hl-5">true</span><span class="hl-1">]);</span><br/><br/><span class="hl-1">        </span><span class="hl-10">// Now we&#39;re ready to process another request for user data so update</span><br/><span class="hl-1">        </span><span class="hl-10">// the flag&#39;s value.</span><br/><span class="hl-1">        </span><span class="hl-4">readUserStatus</span><span class="hl-1"> = </span><span class="hl-2">&quot;inactive&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">      });</span><br/><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> [</span><span class="hl-4">state</span><span class="hl-1">];</span><br/><span class="hl-1">  };</span><br/><br/><span class="hl-1">  </span><span class="hl-10">// Return an array of ActionHandlers.</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> [</span><span class="hl-4">readUser</span><span class="hl-1">];</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-10">/**</span><br/><span class="hl-10"> * auth.ts</span><br/><span class="hl-10"> * The file that creates the reshaper.</span><br/><span class="hl-10"> */</span><br/><br/><span class="hl-10">// Import the factory function</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">create</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;reshape-state&quot;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">createAuthHandlers</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;./auth-handlers.ts&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-10">// Create the reshaper then invoke the factory function from auth-handlers.ts</span><br/><span class="hl-10">// to generate the handlers.</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">reshaper</span><span class="hl-1"> = </span><span class="hl-0">create</span><span class="hl-1">&lt;</span><span class="hl-7">State</span><span class="hl-1">&gt;();</span><br/><span class="hl-4">reshaper</span><span class="hl-1">.</span><span class="hl-0">addHandlers</span><span class="hl-1">(</span><span class="hl-0">createAuthHandlers</span><span class="hl-1">(</span><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-4">env</span><span class="hl-1">.</span><span class="hl-4">protocol</span><span class="hl-1">, </span><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-4">env</span><span class="hl-1">.</span><span class="hl-4">domain</span><span class="hl-1">, +</span><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-4">env</span><span class="hl-1">.</span><span class="hl-4">port</span><span class="hl-1">));</span>
</code><button>Copy</button></pre>
<p>This pattern can be extended so that handlers for specific business functions or
domains can be organized in different files.</p>
<pre><code class="language-ts"><span class="hl-10">/**</span><br/><span class="hl-10"> * app.ts</span><br/><span class="hl-10"> * The file that creates the reshaper.</span><br/><span class="hl-10"> */</span><br/><br/><span class="hl-10">// Import the factory function</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">create</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;reshape-state&quot;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">createAuthHandlers</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;./auth-handlers.ts&quot;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">createMenuHandlers</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;./menu-handlers.ts&quot;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">createOrderHandlers</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;./order-handlers.ts&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-10">// Here the results of multiple handler factory functions are being passed to the reshaper.</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">reshaper</span><span class="hl-1"> = </span><span class="hl-0">create</span><span class="hl-1">&lt;</span><span class="hl-7">State</span><span class="hl-1">&gt;();</span><br/><span class="hl-4">reshaper</span><span class="hl-1">.</span><span class="hl-0">addHandlers</span><span class="hl-1">([</span><br/><span class="hl-1">  ...</span><span class="hl-0">createAuthHandlers</span><span class="hl-1">(</span><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-4">env</span><span class="hl-1">.</span><span class="hl-4">auth_protocol</span><span class="hl-1">, </span><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-4">env</span><span class="hl-1">.</span><span class="hl-4">auth_domain</span><span class="hl-1">, +</span><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-4">env</span><span class="hl-1">.</span><span class="hl-4">auth_port</span><span class="hl-1">),</span><br/><span class="hl-1">  ...</span><span class="hl-0">createMenuHandlers</span><span class="hl-1">(</span><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-4">env</span><span class="hl-1">.</span><span class="hl-4">protocol</span><span class="hl-1">, </span><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-4">env</span><span class="hl-1">.</span><span class="hl-4">domain</span><span class="hl-1">, +</span><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-4">env</span><span class="hl-1">.</span><span class="hl-4">port</span><span class="hl-1">),</span><br/><span class="hl-1">  ...</span><span class="hl-0">createOrderHandlers</span><span class="hl-1">(</span><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-4">env</span><span class="hl-1">.</span><span class="hl-4">protocol</span><span class="hl-1">, </span><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-4">env</span><span class="hl-1">.</span><span class="hl-4">domain</span><span class="hl-1">, +</span><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-4">env</span><span class="hl-1">.</span><span class="hl-4">port</span><span class="hl-1">)</span><br/><span class="hl-1">]);</span>
</code><button>Copy</button></pre>
<a id="md:react-integration" class="tsd-anchor"></a><h3><a href="#md:react-integration">React integration</a></h3><p>One way to integrate reshape-state into React is to use Context with components
for state management. Several key points are:</p>
<ul>
<li>Use an OnChange handler in the Context&#39;s Provider to store state in the
value of a <code>useState</code> hook.</li>
<li>Update state through functions on properties of the Context value. In turn
those functions will use dispatch to update state.</li>
</ul>
<p>Commonly this implementation is enhanced through the use of custom hooks to
split up changes to context data values (which change) from context function
values (which usually don&#39;t change). The custom hooks can also use selector
functions to reduce the number of rerenders that changes to state might cause.</p>
<p>Also since different Contexts can be provided at different locations through the
React component tree it&#39;s possible to have a unique reshaper instance in each
different Context as needed.</p>
<pre><code class="language-tsx"><span class="hl-10">/**</span><br/><span class="hl-10"> * context.ts</span><br/><span class="hl-10"> */</span><br/><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">Context</span><span class="hl-1"> = </span><span class="hl-0">createContext</span><span class="hl-1">();</span><br/><br/><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-4">Provider</span><span class="hl-1"> ({</span><span class="hl-4">children</span><span class="hl-1">, </span><span class="hl-4">reshaper</span><span class="hl-1">}: </span><span class="hl-4">Props</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> [</span><span class="hl-4">data</span><span class="hl-1">, </span><span class="hl-4">setData</span><span class="hl-1">] = </span><span class="hl-4">useState</span><span class="hl-1">&lt;</span><span class="hl-4">unknown</span><span class="hl-1">&gt;();</span><br/><br/><span class="hl-1">  </span><span class="hl-10">// When state is changed by the reshaper all of its OnChange handlers will be</span><br/><span class="hl-1">  </span><span class="hl-10">// invoked. Set the state value passed to the OnChange handler into a</span><br/><span class="hl-1">  </span><span class="hl-10">// `useState` hook.</span><br/><span class="hl-1">  </span><span class="hl-4">useEffect</span><span class="hl-1">(() =&gt; {</span><br/><span class="hl-1">    </span><span class="hl-4">function</span><span class="hl-1"> </span><span class="hl-4">handleChange</span><span class="hl-1"> (</span><span class="hl-4">nextState</span><span class="hl-1">: </span><span class="hl-4">unknown</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-10">// Remember, the reshaper doesn&#39;t determine if state has changed based on</span><br/><span class="hl-1">      </span><span class="hl-10">// a value comparison, the developer indicates if it has changed. React</span><br/><span class="hl-1">      </span><span class="hl-10">// however uses a value comparison to determine when the value set on a</span><br/><span class="hl-1">      </span><span class="hl-10">// `useState` hook has changed. Here the `nextState` value is spread to</span><br/><span class="hl-1">      </span><span class="hl-10">// create a new object instance which will trigger a React update cycle</span><br/><span class="hl-1">      </span><span class="hl-10">// to begin.</span><br/><span class="hl-1">      </span><span class="hl-4">setData</span><span class="hl-1">(...</span><span class="hl-4">nextState</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-4">reshaper</span><span class="hl-1">.</span><span class="hl-0">addOnChange</span><span class="hl-1">(</span><span class="hl-4">handleChange</span><span class="hl-1">);</span><br/><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> () </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">reshaper</span><span class="hl-1">.</span><span class="hl-0">removeOnChange</span><span class="hl-1">(</span><span class="hl-4">handleChange</span><span class="hl-1">);</span><br/><span class="hl-1">    };</span><br/><span class="hl-1">  }, [</span><span class="hl-4">reshaper</span><span class="hl-1">]);</span><br/><br/><span class="hl-1">  </span><span class="hl-10">// Provide a function to the reshaper that returns the current value of state</span><br/><span class="hl-1">  </span><span class="hl-10">// to the reshaper. Note that this is done in a separate hook because the</span><br/><span class="hl-1">  </span><span class="hl-10">// GetState function needs to be updated with the current state every time</span><br/><span class="hl-1">  </span><span class="hl-10">// state changes.  </span><br/><span class="hl-1">  </span><span class="hl-0">useEffect</span><span class="hl-1">(() </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">reshaper</span><span class="hl-1">.</span><span class="hl-0">setGetState</span><span class="hl-1">(() </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-4">data</span><span class="hl-1">);</span><br/><span class="hl-1">  }, [</span><span class="hl-4">reshaper</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">]);</span><br/><br/><span class="hl-1">  </span><span class="hl-10">// Create the value that is passed through Context. This includes the state</span><br/><span class="hl-1">  </span><span class="hl-10">// (data) as well as a function to update the name field that will dispatch</span><br/><span class="hl-1">  </span><span class="hl-10">// an action to the reshaper.</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">value</span><span class="hl-1"> = {</span><br/><span class="hl-1">    ...</span><span class="hl-4">data</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">setName</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">name</span><span class="hl-1">: </span><span class="hl-7">string</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-4">reshaper</span><span class="hl-1">.</span><span class="hl-0">dispatch</span><span class="hl-1">({ </span><span class="hl-4">payload:</span><span class="hl-1"> </span><span class="hl-4">name</span><span class="hl-1">, </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-2">&quot;UPDATE_NAME&quot;</span><span class="hl-1"> });</span><br/><span class="hl-1">  };</span><br/><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-11">&lt;</span><span class="hl-7">Context.Provider</span><span class="hl-1"> </span><span class="hl-12">value</span><span class="hl-1">=</span><span class="hl-5">{</span><span class="hl-4">value</span><span class="hl-5">}</span><span class="hl-11">&gt;</span><span class="hl-5">{</span><span class="hl-4">children</span><span class="hl-5">}</span><span class="hl-11">&lt;/</span><span class="hl-7">Context.Provider</span><span class="hl-11">&gt;</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<pre><code class="language-tsx"><span class="hl-10">/**</span><br/><span class="hl-10"> * A component that uses the data and function values provided through Context.</span><br/><span class="hl-10"> */</span><br/><br/><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-5">function</span><span class="hl-1"> </span><span class="hl-0">MyComponent</span><span class="hl-1">() {</span><br/><span class="hl-1">  </span><span class="hl-10">// Extract the value that we need from Context</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> { </span><span class="hl-6">name</span><span class="hl-1">, </span><span class="hl-6">setName</span><span class="hl-1"> } = </span><span class="hl-0">useContext</span><span class="hl-1">(</span><span class="hl-4">Context</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  </span><span class="hl-10">// When the user types the name will be updated in state.</span><br/><span class="hl-1">  </span><span class="hl-5">function</span><span class="hl-1"> </span><span class="hl-0">handleInput</span><span class="hl-1">(</span><span class="hl-4">evt</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">setName</span><span class="hl-1">(</span><span class="hl-4">evt</span><span class="hl-1">.</span><span class="hl-4">target</span><span class="hl-1">.</span><span class="hl-4">value</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-11">&lt;</span><span class="hl-13">input</span><span class="hl-1"> </span><span class="hl-12">onInput</span><span class="hl-1">=</span><span class="hl-5">{</span><span class="hl-4">handleInput</span><span class="hl-5">}</span><span class="hl-1"> </span><span class="hl-12">value</span><span class="hl-1">=</span><span class="hl-5">{</span><span class="hl-4">name</span><span class="hl-5">}</span><span class="hl-1"> </span><span class="hl-11">/&gt;</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-index-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><h4 class="uppercase">Member Visibility</h4><form><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div><div class="tsd-theme-toggle"><h4 class="uppercase">Theme</h4><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-index-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:reshape-state"><span>reshape-<wbr/>state</span></a><ul><li><a href="#md:install"><span>Install</span></a></li><li><a href="#md:usage"><span>Usage</span></a></li><li><ul><li><a href="#md:create"><span>Create</span></a></li><li><a href="#md:provide-the-current-state"><span>Provide the current state</span></a></li><li><a href="#md:listen-for-state-changes"><span>Listen for state changes</span></a></li><li><a href="#md:dispatch-actions-to-handlers"><span>Dispatch actions to handlers</span></a></li><li><a href="#md:update-state-with-handler-functions"><span>Update state with handler functions</span></a></li><li><a href="#md:dispatch-inline-handlers"><span>Dispatch inline handlers</span></a></li><li><a href="#md:changing-state-without-an-action"><span>Changing state without an action</span></a></li><li><a href="#md:remove-listeners-and-handlers"><span>Remove listeners and handlers</span></a></li></ul></li><li><a href="#md:tips"><span>Tips</span></a></li><li><ul><li><a href="#md:create-handler-functions-using-a-factory-function"><span>Create handler functions using a factory function</span></a></li><li><a href="#md:react-integration"><span>React integration</span></a></li></ul></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>reshape-state - v1.4.1</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>